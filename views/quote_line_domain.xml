<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- Heredamos el formulario de ccn.service.quote y forzamos el dominio del product_id -->
    <record id="ccn_view_quote_form_filter_products" model="ir.ui.view">
      <field name="name">ccn.quote.form.filter.products</field>
      <field name="model">ccn.service.quote</field>
      <field name="inherit_id" ref="ccn_service_quote.ccn_view_quote_form"/>
      <field name="arch" type="xml">

        <!-- localiza el tree/list de line_ids y ajusta el campo product_id -->
        <xpath expr="//form//field[@name='line_ids']//field[@name='product_id']" position="attributes">
          <attribute name="domain">
            [
              ('product_tmpl_id.ccn_exclude_from_quote','=',False),
              ('product_tmpl_id.ccn_rubro_ids','in',[rubro_id])
            ]
          </attribute>
          <attribute name="context">{'default_type': 'service'}</attribute>
        </xpath>

      </field>
    </record>

  </data>
</odoo>
