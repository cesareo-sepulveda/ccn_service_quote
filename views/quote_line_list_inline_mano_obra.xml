<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- LIST INLINE específica para Mano de Obra -->
    <record id="ccn_view_quote_line_list_inline_mano_obra" model="ir.ui.view">
      <field name="name">ccn.quote.line.list.inline.mano_obra</field>
      <field name="model">ccn.service.quote.line</field>
      <field name="type">list</field>
      <field name="arch" type="xml">
        <list editable="bottom" string="Líneas Mano de Obra" edit="parent.state in ['draft', 'pending']" create="parent.state in ['draft', 'pending']" delete="parent.state in ['draft', 'pending']">
          <control>
            <create string="Agregar una línea"/>
            <button string="Catálogo" type="object" name="action_open_catalog_wizard" context="{'rubro_code': 'mano_obra'}" class="btn-link" invisible="parent.state == 'authorized'"/>
          </control>
          <field name="rubro_id" invisible="1" column_invisible="1"/>
          <field name="rubro_code" invisible="1" column_invisible="1"/>

          <!-- Producto/Servicio del rubro -->
          <field name="product_id"
                 required="1"
                 string="Puesto"
                 domain="[('product_tmpl_id.ccn_exclude_from_quote','=',False),
                          ('product_tmpl_id.sale_ok','=', True),
                          ('product_tmpl_id.ccn_rubro_ids.code','in',[context.get('ctx_rubro_code'), rubro_code])]"
                 context="{'search_default_sale_ok': 1}"
                 options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>

          <!-- Cantidad (segunda columna) -->
          <field name="quantity"/>

          <!-- Percepción Base (antes: Precio Base) -->
          <field name="product_base_price" string="Percepción" readonly="1"/>

          <!-- Tabulador -->
          <field name="tabulator_percent" string="Tabulador"/>

          <!-- Percepción Ajustada (antes: Precio Ajustado) -->
          <field name="price_unit_final" string="Ajuste" readonly="1"/>

          <!-- Frecuencia (solo Semanal/Quincenal/Mensual en Mano de Obra) -->
          <field name="frequency" string="Frecuencia" context="{'ccn_mo_freq_only': True}"/>

          <!-- Percepción Mensual (antes: Subtotal Mensual) -->
          <field name="monthly_subtotal" string="Mensual" readonly="1"/>

          <!-- Prestaciones (Percepción Mensual x % prestaciones) -->
          <field name="mo_prestaciones" string="Prestaciones" readonly="1"/>

          <!-- Total Mensual = (Percepción Mensual + Prestaciones) x Cantidad -->
          <field name="total_price" string="Total Mensual" readonly="1"/>

          <!-- Metadatos y diagnóstico oculto -->
          <field name="site_id" string="Sitio" optional="hide"/>
          <field name="service_type" string="Servicio" optional="hide"/>
          <field name="quote_id" invisible="1" column_invisible="1"/>
          <field name="type" invisible="1" column_invisible="1"/>
          <field name="currency_id" invisible="1" column_invisible="1"/>
        </list>
      </field>
    </record>

    <!-- FORM INLINE específica para Mano de Obra -->
    <record id="ccn_view_quote_line_form_inline_mano_obra" model="ir.ui.view">
      <field name="name">ccn.quote.line.form.inline.mano_obra</field>
      <field name="model">ccn.service.quote.line</field>
      <field name="type">form</field>
      <field name="arch" type="xml">
        <form string="Línea Mano de Obra">
          <group>
            <field name="rubro_id" invisible="1"/>
            <field name="rubro_code" invisible="1"/>

            <field name="product_id" required="1" string="Puesto"
                   domain="[('product_tmpl_id.ccn_exclude_from_quote','=',False),
                            ('product_tmpl_id.sale_ok','=', True),
                            ('product_tmpl_id.ccn_rubro_ids.code','in',[context.get('ctx_rubro_code'), rubro_code])] "
                   context="{'search_default_sale_ok': 1}"
                   options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>

            <field name="quantity"/>
            <field name="product_base_price" string="Percepción" readonly="1"/>
            <field name="tabulator_percent" string="Tabulador"/>
            <field name="price_unit_final" string="Ajuste" readonly="1"/>
            <field name="frequency" string="Frecuencia" context="{'ccn_mo_freq_only': True}"/>
            <field name="monthly_subtotal" string="Mensual" readonly="1"/>
            <field name="mo_prestaciones" string="Prestaciones" readonly="1"/>
            <field name="total_price" string="Total Mensual" readonly="1"/>

            <field name="quote_id" invisible="1"/>
            <field name="site_id" invisible="1"/>
            <field name="service_type" invisible="1"/>
            <field name="type" invisible="1"/>
            <field name="currency_id" invisible="1"/>
          </group>
        </form>
      </field>
    </record>

  </data>
</odoo>
