<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <record id="ccn_view_quote_form" model="ir.ui.view">
      <field name="name">ccn.quote.form</field>
      <field name="model">ccn.service.quote</field>
      <field name="arch" type="xml">
        <form string="Cotizador Especial CCN">
          <sheet>

            <!-- ===== Cabecera con etiquetas a la izquierda (2 columnas) ===== -->
            <group>
              <group col="2">

                <!-- Cliente -->
                <label for="partner_id" string="Cliente"/>
                <field name="partner_id" required="1" nolabel="1" options="{'no_create_edit': True}"/>

                <!-- Nombre de la cotización -->
                <label for="name" string="Nombre"/>
                <field name="name" required="1" nolabel="1"/>

                <!-- Sitio + botón en la misma fila -->
                <label for="current_site_id" string="Sitio"/>
                <div class="o_row">
                  <field name="current_site_id"
                         nolabel="1"
                         domain="['|', ('id','=', current_site_id), ('quote_id','=', id)]"
                         context="{'default_quote_id': id}"
                         options="{'no_open': True, 'no_create_edit': True}"
                         class="o_me_2"/>
                  <button name="action_ensure_general"
                          type="object"
                          class="btn-secondary"
                          string="Sitio General"/>
                </div>

                <!-- Tipo de servicio -->
                <label for="current_service_type" string="Tipo de servicio"/>
                <field name="current_service_type" nolabel="1"/>

                <!-- Modo de presentación -->
                <label for="display_mode" string="Modo de presentación"/>
                <field name="display_mode" nolabel="1"/>

                <!-- Parámetros -->
                <label for="admin_percent" string="Administración (%)"/>
                <field name="admin_percent" nolabel="1"/>

                <label for="utility_percent" string="Utilidad (%)"/>
                <field name="utility_percent" nolabel="1"/>

                <label for="financial_percent" string="Costo Financiero (%)"/>
                <field name="financial_percent" nolabel="1"/>

                <label for="transporte_rate" string="Tarifa Transporte P/P"/>
                <field name="transporte_rate" nolabel="1"/>

                <label for="bienestar_rate" string="Tarifa Bienestar P/P"/>
                <field name="bienestar_rate" nolabel="1"/>

              </group>
            </group>

            <!-- ===== Tabs por rubro (edición inline con list) ===== -->
            <notebook>

              <page string="Mano de Obra" name="page_mano_obra"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'mano_obra'}"
                        invisible="rubro_state_mano_obra == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'mano_obra'}"
                        invisible="rubro_state_mano_obra != 2"/>

                <field name="line_mano_obra_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'mano_obra'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Mano de Obra">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Uniforme" name="page_uniforme"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'uniforme'}"
                        invisible="rubro_state_uniforme == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'uniforme'}"
                        invisible="rubro_state_uniforme != 2"/>

                <field name="line_uniforme_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'uniforme'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Uniforme">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="EPP" name="page_epp"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp'}"
                        invisible="rubro_state_epp == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp'}"
                        invisible="rubro_state_epp != 2"/>

                <field name="line_epp_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas EPP">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="EPP Alturas" name="page_epp_alturas"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp_alturas'}"
                        invisible="rubro_state_epp_alturas == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp_alturas'}"
                        invisible="rubro_state_epp_alturas != 2"/>

                <field name="line_epp_alturas_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp_alturas'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas EPP Alturas">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Equipo Especial de Limpieza" name="page_equipo_especial_limpieza"
                    invisible="current_service_type != 'limpieza'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'equipo_especial_limpieza'}"
                        invisible="rubro_state_equipo_especial_limpieza == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'equipo_especial_limpieza'}"
                        invisible="rubro_state_equipo_especial_limpieza != 2"/>

                <field name="line_equipo_especial_limpieza_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'equipo_especial_limpieza'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Equipo Especial de Limpieza">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Comunicación y Cómputo" name="page_comunicacion_computo"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'comunicacion_computo'}"
                        invisible="rubro_state_comunicacion_computo == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'comunicacion_computo'}"
                        invisible="rubro_state_comunicacion_computo != 2"/>

                <field name="line_comunicacion_computo_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'comunicacion_computo'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Comunicación y Cómputo">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Herr. Menor Jardinería" name="page_herr_menor_jardineria"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'herramienta_menor_jardineria'}"
                        invisible="rubro_state_herramienta_menor_jardineria == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'herramienta_menor_jardineria'}"
                        invisible="rubro_state_herramienta_menor_jardineria != 2"/>

                <field name="line_herramienta_menor_jardineria_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'herramienta_menor_jardineria'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Herr. Menor Jardinería">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Material de Limpieza" name="page_material_limpieza"
                    invisible="current_service_type != 'limpieza'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'material_limpieza'}"
                        invisible="rubro_state_material_limpieza == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'material_limpieza'}"
                        invisible="rubro_state_material_limpieza != 2"/>

                <field name="line_material_limpieza_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'material_limpieza'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Material de Limpieza">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Perfil Médico" name="page_perfil_medico"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'perfil_medico'}"
                        invisible="rubro_state_perfil_medico == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'perfil_medico'}"
                        invisible="rubro_state_perfil_medico != 2"/>

                <field name="line_perfil_medico_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'perfil_medico'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Perfil Médico">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Maquinaria de Limpieza" name="page_maquinaria_limpieza"
                    invisible="current_service_type != 'limpieza'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_limpieza'}"
                        invisible="rubro_state_maquinaria_limpieza == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_limpieza'}"
                        invisible="rubro_state_maquinaria_limpieza != 2"/>

                <field name="line_maquinaria_limpieza_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'maquinaria_limpieza'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Maquinaria de Limpieza">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Maquinaria de Jardinería" name="page_maquinaria_jardineria"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_jardineria'}"
                        invisible="rubro_state_maquinaria_jardineria == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_jardineria'}"
                        invisible="rubro_state_maquinaria_jardineria != 2"/>

                <field name="line_maquinaria_jardineria_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'maquinaria_jardineria'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Maquinaria de Jardinería">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Fertilizantes y Tierra Lama" name="page_fertilizantes_tierra_lama"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'fertilizantes_tierra_lama'}"
                        invisible="rubro_state_fertilizantes_tierra_lama == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'fertilizantes_tierra_lama'}"
                        invisible="rubro_state_fertilizantes_tierra_lama != 2"/>

                <field name="line_fertilizantes_tierra_lama_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'fertilizantes_tierra_lama'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Fertilizantes y Tierra Lama">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Consumibles de Jardinería" name="page_consumibles_jardineria"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'consumibles_jardineria'}"
                        invisible="rubro_state_consumibles_jardineria == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'consumibles_jardineria'}"
                        invisible="rubro_state_consumibles_jardineria != 2"/>

                <field name="line_consumibles_jardineria_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'consumibles_jardineria'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Consumibles de Jardinería">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Capacitación" name="page_capacitacion"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'capacitacion'}"
                        invisible="rubro_state_capacitacion == 2"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'capacitacion'}"
                        invisible="rubro_state_capacitacion != 2"/>

                <field name="line_capacitacion_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'capacitacion'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]">
                  <list editable="bottom" string="Líneas Capacitación">
                    <field name="product_id" options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                    <field name="quantity"/>
                    <field name="tabulator_percent"/>
                    <field name="price_unit_final" readonly="1"/>
                    <field name="total_price" readonly="1"/>
                  </list>
                </field>
              </page>

              <page string="Resumen Global">
                <div class="o_form_label">Resumen global pendiente (se llenará posteriormente).</div>
              </page>

            </notebook>
          </sheet>
        </form>
      </field>
    </record>
  <!-- Lista principal: muestra el Cliente -->
    <record id="ccn_view_quote_list" model="ir.ui.view">
      <field name="name">ccn.quote.list</field>
      <field name="model">ccn.service.quote</field>
      <!-- Prioridad baja = más preferida; asegura que esta lista sea la que se use -->
      <field name="priority" eval="1"/>
      <field name="arch" type="xml">
        <list string="Cotizaciones CCN">
          <field name="partner_id" string="Cliente"/>
          <field name="name" string="Nombre"/>
          <!-- Columnas opcionales que puedes dejar visibles/ocultables -->
          <field name="current_service_type" optional="show"/>
          <field name="display_mode" optional="hide"/>
          <field name="current_site_id" string="Sitio" optional="show"/>
        </list>
      </field>
    </record>

  </data>
</odoo>
