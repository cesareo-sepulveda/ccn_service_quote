<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <record id="ccn_view_quote_form" model="ir.ui.view">
      <field name="name">ccn.quote.form</field>
      <field name="model">ccn.service.quote</field>
      <field name="arch" type="xml">
        <form string="Cotizador Especial CCN">
          <sheet>

            <!-- Cabecera -->
            <group>
              <field name="partner_id" required="1"/>
              <field name="name" colspan="2"/>
              <!-- IMPORTANT: limitar al conjunto de sitios del O2M (incluye 'General' virtual) -->
              <field name="current_site_id"
                     domain="[('id','in', site_ids)]"
                     options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"
                     colspan="2"/>
              <field name="current_service_type" colspan="2"/>
              <field name="display_mode" colspan="2"/>
              <field name="admin_percent" colspan="2"/>
              <field name="utility_percent" colspan="2"/>
              <field name="financial_percent" colspan="2"/>
              <field name="transporte_rate" colspan="2"/>
              <field name="bienestar_rate" colspan="2"/>
            </group>

            <!-- Tabs por rubro (edición inline) -->
            <notebook attrs="{'invisible': [('current_service_type', '=', False)]}">

              <page string="Mano de Obra" name="page_mano_obra"
                    attrs="{'invisible': [('current_service_type','not in',['jardineria','limpieza'])]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'mano_obra'}"
                        attrs="{'invisible': [('rubro_state_mano_obra','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'mano_obra'}"
                        attrs="{'invisible': [('rubro_state_mano_obra','!=',2)]}"/>
                <field name="line_mano_obra_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'mano_obra',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Uniforme" name="page_uniforme"
                    attrs="{'invisible': [('current_service_type','not in',['jardineria','limpieza'])]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'uniforme'}"
                        attrs="{'invisible': [('rubro_state_uniforme','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'uniforme'}"
                        attrs="{'invisible': [('rubro_state_uniforme','!=',2)]}"/>
                <field name="line_uniforme_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'uniforme',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="EPP" name="page_epp"
                    attrs="{'invisible': [('current_service_type','not in',['jardineria','limpieza'])]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp'}"
                        attrs="{'invisible': [('rubro_state_epp','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp'}"
                        attrs="{'invisible': [('rubro_state_epp','!=',2)]}"/>
                <field name="line_epp_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="EPP Alturas" name="page_epp_alturas"
                    attrs="{'invisible': [('current_service_type','!=','jardineria')]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp_alturas'}"
                        attrs="{'invisible': [('rubro_state_epp_alturas','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp_alturas'}"
                        attrs="{'invisible': [('rubro_state_epp_alturas','!=',2)]}"/>
                <field name="line_epp_alturas_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp_alturas',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Equipo Especial de Limpieza" name="page_equipo_especial_limpieza"
                    attrs="{'invisible': [('current_service_type','!=','limpieza')]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'equipo_especial_limpieza'}"
                        attrs="{'invisible': [('rubro_state_equipo_especial_limpieza','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'equipo_especial_limpieza'}"
                        attrs="{'invisible': [('rubro_state_equipo_especial_limpieza','!=',2)]}"/>
                <field name="line_equipo_especial_limpieza_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'equipo_especial_limpieza',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Comunicación y Cómputo" name="page_comunicacion_computo"
                    attrs="{'invisible': [('current_service_type','not in',['jardineria','limpieza'])]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'comunicacion_computo'}"
                        attrs="{'invisible': [('rubro_state_comunicacion_computo','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'comunicacion_computo'}"
                        attrs="{'invisible': [('rubro_state_comunicacion_computo','!=',2)]}"/>
                <field name="line_comunicacion_computo_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'comunicacion_computo',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Herr. Menor Jardinería" name="page_herr_menor_jardineria"
                    attrs="{'invisible': [('current_service_type','!=','jardineria')]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'herramienta_menor_jardineria'}"
                        attrs="{'invisible': [('rubro_state_herramienta_menor_jardineria','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'herramienta_menor_jardineria'}"
                        attrs="{'invisible': [('rubro_state_herramienta_menor_jardineria','!=',2)]}"/>
                <field name="line_herramienta_menor_jardineria_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'herramienta_menor_jardineria',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Material de Limpieza" name="page_material_limpieza"
                    attrs="{'invisible': [('current_service_type','!=','limpieza')]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'material_limpieza'}"
                        attrs="{'invisible': [('rubro_state_material_limpieza','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'material_limpieza'}"
                        attrs="{'invisible': [('rubro_state_material_limpieza','!=',2)]}"/>
                <field name="line_material_limpieza_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'material_limpieza',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Perfil Médico" name="page_perfil_medico"
                    attrs="{'invisible': [('current_service_type','not in',['jardineria','limpieza'])]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'perfil_medico'}"
                        attrs="{'invisible': [('rubro_state_perfil_medico','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'perfil_medico'}"
                        attrs="{'invisible': [('rubro_state_perfil_medico','!=',2)]}"/>
                <field name="line_perfil_medico_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'perfil_medico',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Maquinaria de Limpieza" name="page_maquinaria_limpieza"
                    attrs="{'invisible': [('current_service_type','!=','limpieza')]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_limpieza'}"
                        attrs="{'invisible': [('rubro_state_maquinaria_limpieza','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_limpieza'}"
                        attrs="{'invisible': [('rubro_state_maquinaria_limpieza','!=',2)]}"/>
                <field name="line_maquinaria_limpieza_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'maquinaria_limpieza',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Maquinaria de Jardinería" name="page_maquinaria_jardineria"
                    attrs="{'invisible': [('current_service_type','!=','jardineria')]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_jardineria'}"
                        attrs="{'invisible': [('rubro_state_maquinaria_jardineria','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_jardineria'}"
                        attrs="{'invisible': [('rubro_state_maquinaria_jardineria','!=',2)]}"/>
                <field name="line_maquinaria_jardineria_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'maquinaria_jardineria',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Fertilizantes y Tierra Lama" name="page_fertilizantes_tierra_lama"
                    attrs="{'invisible': [('current_service_type','!=','jardineria')]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'fertilizantes_tierra_lama'}"
                        attrs="{'invisible': [('rubro_state_fertilizantes_tierra_lama','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'fertilizantes_tierra_lama'}"
                        attrs="{'invisible': [('rubro_state_fertilizantes_tierra_lama','!=',2)]}"/>
                <field name="line_fertilizantes_tierra_lama_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'fertilizantes_tierra_lama',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Consumibles de Jardinería" name="page_consumibles_jardineria"
                    attrs="{'invisible': [('current_service_type','!=','jardineria')]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'consumibles_jardineria'}"
                        attrs="{'invisible': [('rubro_state_consumibles_jardineria','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'consumibles_jardineria'}"
                        attrs="{'invisible': [('rubro_state_consumibles_jardineria','!=',2)]}"/>
                <field name="line_consumibles_jardineria_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'consumibles_jardineria',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <page string="Capacitación" name="page_capacitacion"
                    attrs="{'invisible': [('current_service_type','not in',['jardineria','limpieza'])]}">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'capacitacion'}"
                        attrs="{'invisible': [('rubro_state_capacitacion','=',2)]}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'capacitacion'}"
                        attrs="{'invisible': [('rubro_state_capacitacion','!=',2)]}"/>
                <field name="line_capacitacion_ids"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'capacitacion',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

            </notebook>
          </sheet>
        </form>
      </field>
    </record>

  </data>
</odoo>
