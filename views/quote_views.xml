<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <record id="ccn_view_quote_form" model="ir.ui.view">
      <field name="name">ccn.quote.form</field>
      <field name="model">ccn.service.quote</field>
      <field name="type">form</field>
      <field name="arch" type="xml">
        <form string="CCN Service Quote">
          <sheet>

            <!-- Cabecera sin repetir "Sitio" -->
            <group>
              <group>
                <field name="name"/>
              </group>
              <group string="Modo de presentación">
                <field name="current_site_id" domain="[('quote_id','=', id)]"/>
                <field name="current_service_type"/>
                <field name="current_type"/>
              </group>
            </group>

            <!-- Tabs por rubro (edición inline) -->
            <notebook invisible="not current_service_type">

              <page string="Mano de Obra"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'mano_obra',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','mano_obra')
                       ]"/>
              </page>

              <page string="Uniforme"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'uniforme',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','uniforme')
                       ]"/>
              </page>

              <page string="EPP"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','epp')
                       ]"/>
              </page>

              <page string="EPP Alturas"
                    invisible="current_service_type != 'jardineria'">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp_alturas',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','epp_alturas')
                       ]"/>
              </page>

              <page string="Equipo Especial de Limpieza"
                    invisible="current_service_type != 'limpieza'">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'equipo_especial_limpieza',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','equipo_especial_limpieza')
                       ]"/>
              </page>

              <page string="Comunicación y Cómputo"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'comunicacion_computo',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','comunicacion_computo')
                       ]"/>
              </page>

              <page string="Herr. Menor Jardinería"
                    invisible="current_service_type != 'jardineria'">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'herramienta_menor_jardineria',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','herramienta_menor_jardineria')
                       ]"/>
              </page>

              <page string="Material de Limpieza"
                    invisible="current_service_type != 'limpieza'">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'material_limpieza',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','material_limpieza')
                       ]"/>
              </page>

              <page string="Perfil Médico"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'perfil_medico',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','perfil_medico')
                       ]"/>
              </page>

              <page string="Maquinaria de Limpieza"
                    invisible="current_service_type != 'limpieza'">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'maquinaria_limpieza',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','maquinaria_limpieza')
                       ]"/>
              </page>

              <page string="Maquinaria de Jardinería"
                    invisible="current_service_type != 'jardineria'">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'maquinaria_jardineria',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','maquinaria_jardineria')
                       ]"/>
              </page>

              <page string="Fertilizantes y Tierra Lama"
                    invisible="current_service_type != 'jardineria'">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'fertilizantes_tierra_lama',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','fertilizantes_tierra_lama')
                       ]"/>
              </page>

              <page string="Consumibles de Jardinería"
                    invisible="current_service_type != 'jardineria'">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'consumibles_jardineria',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','consumibles_jardineria')
                       ]"/>
              </page>

              <page string="Capacitación"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <field name="line_ids" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_type': current_type,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'capacitacion',
                         'tree_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline'
                       }"
                       domain="[
                         ('quote_id','=', id),
                         ('site_id','=', current_site_id),
                         ('type','=', current_type),
                         ('service_type','=', current_service_type),
                         ('rubro_id.code','=','capacitacion')
                       ]"/>
              </page>

            </notebook>
          </sheet>
        </form>
      </field>
    </record>

  </data>
</odoo>
