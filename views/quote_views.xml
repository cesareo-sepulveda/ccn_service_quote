<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- ================================
         LISTA (vista inicial)
       ================================ -->
    <record id="ccn_view_quote_list" model="ir.ui.view">
      <field name="name">ccn.quote.list</field>
      <field name="model">ccn.service.quote</field>
      <field name="type">list</field>
      <field name="priority">1</field>
      <field name="arch" type="xml">
        <list string="Cotizaciones CCN" default_order="partner_id,name">
          <field name="partner_id" string="Cliente"/>
          <field name="name" string="Cotización"/>
          <field name="current_service_type" string="Tipo de servicio"/>
          <field name="current_site_id" string="Sitio actual" optional="hide"/>
          <field name="display_mode" string="Modo presentación" optional="hide"/>
          <field name="create_date" string="Creado" optional="hide"/>
          <field name="write_date" string="Actualizado" optional="hide"/>
        </list>
      </field>
    </record>

    <!-- ================================
         SEARCH (filtros/búsqueda)
       ================================ -->
    <record id="ccn_view_quote_search" model="ir.ui.view">
      <field name="name">ccn.quote.search</field>
      <field name="model">ccn.service.quote</field>
      <field name="type">search</field>
      <field name="arch" type="xml">
        <search string="Buscar Cotizaciones">
          <field name="name" string="Cotización"/>
          <field name="partner_id" string="Cliente"/>
          <field name="current_service_type" string="Tipo de servicio"/>
          <filter string="Jardinería" name="f_jardineria"
                  domain="[('current_service_type','=','jardineria')]"/>
          <filter string="Limpieza" name="f_limpieza"
                  domain="[('current_service_type','=','limpieza')]"/>
          <group expand="0" string="Agrupar por">
            <filter string="Cliente" name="g_partner" context="{'group_by':'partner_id'}"/>
            <filter string="Tipo de servicio" name="g_service_type" context="{'group_by':'current_service_type'}"/>
          </group>
        </search>
      </field>
    </record>

    <!-- ================================
         FORM (con etiquetas explícitas)
       ================================ -->
    <record id="ccn_view_quote_form" model="ir.ui.view">
      <field name="name">ccn.quote.form</field>
      <field name="model">ccn.service.quote</field>
      <field name="type">form</field>
      <field name="arch" type="xml">
        <form string="Cotizador Especial CCN" class="ccn-quote">
          <sheet>

            <!-- ===== Cabecera con etiquetas a la izquierda (2 columnas) ===== -->
            <group col="2">

              <!-- Cliente -->
                <field name="partner_id" required="1" string="Cliente"/>
 
                <!-- Nombre de la cotización -->
                <field name="name" string="Nombre de la cotización"/>
 
                <!-- Sitio + botón (botón bajo el campo en misma columna) -->
                <field name="current_site_id" string="Sitio"
                       domain="[('quote_id','in',[False, id])]"
                       context="{'default_quote_id': id}"
                       options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
 
                <!-- Espaciador con estilo de etiqueta (NO usar <label/> vacío en Odoo 18) -->
                <div class="o_form_label"/>
                <button name="action_ensure_general"
                        type="object"
                        string="Sitio General"
                        class="btn btn-secondary"/>
 
                <!-- Tipo de servicio -->
                <field name="current_service_type" string="Tipo de servicio"/>
 
                <!-- Parámetros -->
                <field name="display_mode" string="Modo de presentación"/>
 
                <field name="admin_percent" string="Administración (%)"/>
 
                <field name="utility_percent" string="Utilidad (%)"/>
 
                <field name="financial_percent" string="Costo Financiero (%)"/>
 
                <field name="transporte_rate" string="Tarifa Transporte P/P"/>
 
                <field name="bienestar_rate" string="Tarifa Bienestar P/P"/>

            </group>

            <!-- Campos de estado invisibles para el JS de coloreado -->
            <group invisible="1">
              <field name="rubro_state_mano_obra"/>
              <field name="rubro_state_uniforme"/>
              <field name="rubro_state_epp"/>
              <field name="rubro_state_epp_alturas"/>
              <field name="rubro_state_equipo_especial_limpieza"/>
              <field name="rubro_state_comunicacion_computo"/>
              <field name="rubro_state_herramienta_menor_jardineria"/>
              <field name="rubro_state_material_limpieza"/>
              <field name="rubro_state_perfil_medico"/>
              <field name="rubro_state_maquinaria_limpieza"/>
              <field name="rubro_state_maquinaria_jardineria"/>
              <field name="rubro_state_fertilizantes_tierra_lama"/>
              <field name="rubro_state_consumibles_jardineria"/>
              <field name="rubro_state_capacitacion"/>
            </group>

            <!-- ===== Tabs por rubro (solo visibles con tipo de servicio) ===== -->
            <notebook invisible="not current_service_type">

              <!-- Mano de Obra -->
              <page string="Mano de Obra" name="page_mano_obra"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'mano_obra'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'mano_obra'}"/>
                <field name="line_ids_mano_obra" mode="list"
                        context="{
                          'default_quote_id': id,
                          'default_site_id': current_site_id,
                          'default_service_type': current_service_type,
                          'ctx_rubro_code': 'mano_obra',
                          'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                          'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                        }"
                        domain="[
                          ('rubro_code','=','mano_obra'),
                          ('site_id','=', current_site_id),
                          ('service_type','=', current_service_type)
                        ]"/>
              </page>

              <!-- Uniforme -->
              <page string="Uniforme" name="page_uniforme"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'uniforme'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'uniforme'}"/>
                <field name="line_ids_uniforme" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'uniforme',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','uniforme'),
                         ('site_id','=', current_site_id),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- EPP -->
              <page string="EPP" name="page_epp"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp'}"/>
                <field name="line_ids_epp" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','epp'),
                         ('site_id','=', current_site_id),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- EPP Alturas (solo jardinería) -->
              <page string="EPP Alturas" name="page_epp_alturas"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp_alturas'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp_alturas'}"/>
                <field name="line_ids_epp_alturas" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp_alturas',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','epp_alturas'),
                         ('site_id','=', current_site_id),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Equipo Especial de Limpieza (solo limpieza) -->
              <page string="Equipo Especial de Limpieza" name="page_equipo_especial_limpieza"
                    invisible="current_service_type != 'limpieza'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'equipo_especial_limpieza'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'equipo_especial_limpieza'}"/>
                <field name="line_ids_equipo_especial_limpieza" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'equipo_especial_limpieza',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','equipo_especial_limpieza'),
                         ('site_id','=', current_site_id),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Comunicación y Cómputo -->
              <page string="Comunicación y Cómputo" name="page_comunicacion_computo"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'comunicacion_computo'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'comunicacion_computo'}"/>
                <field name="line_ids_comunicacion_computo" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'comunicacion_computo',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','comunicacion_computo'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Herr. Menor Jardinería (solo jardinería) -->
              <page string="Herr. Menor Jardinería" name="page_herr_menor_jardineria"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'herramienta_menor_jardineria'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'herramienta_menor_jardineria'}"/>
                <field name="line_ids_herramienta_menor_jardineria" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'herramienta_menor_jardineria',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','herramienta_menor_jardineria'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Material de Limpieza (solo limpieza) -->
              <page string="Material de Limpieza" name="page_material_limpieza"
                    invisible="current_service_type != 'limpieza'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'material_limpieza'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'material_limpieza'}"/>
                <field name="line_ids_material_limpieza" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'material_limpieza',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','material_limpieza'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Perfil Médico -->
              <page string="Perfil Médico" name="page_perfil_medico"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'perfil_medico'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'perfil_medico'}"/>
                <field name="line_ids_perfil_medico" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'perfil_medico',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','perfil_medico'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Maquinaria de Limpieza (solo limpieza) -->
              <page string="Maquinaria de Limpieza" name="page_maquinaria_limpieza"
                    invisible="current_service_type != 'limpieza'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_limpieza'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_limpieza'}"/>
                <field name="line_ids_maquinaria_limpieza" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'maquinaria_limpieza',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','maquinaria_limpieza'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Maquinaria de Jardinería (solo jardinería) -->
              <page string="Maquinaria de Jardinería" name="page_maquinaria_jardineria"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_jardineria'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_jardineria'}"/>
                <field name="line_ids_maquinaria_jardineria" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'maquinaria_jardineria',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','maquinaria_jardineria'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Fertilizantes y Tierra Lama (solo jardinería) -->
              <page string="Fertilizantes y Tierra Lama" name="page_fertilizantes_tierra_lama"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'fertilizantes_tierra_lama'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'fertilizantes_tierra_lama'}"/>
                <field name="line_ids_fertilizantes_tierra_lama" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'fertilizantes_tierra_lama',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','fertilizantes_tierra_lama'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Consumibles de Jardinería (solo jardinería) -->
              <page string="Consumibles de Jardinería" name="page_consumibles_jardineria"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'consumibles_jardineria'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'consumibles_jardineria'}"/>
                <field name="line_ids_consumibles_jardineria" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'consumibles_jardineria',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','consumibles_jardineria'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Capacitación -->
              <page string="Capacitación" name="page_capacitacion"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'capacitacion'}"/>
                <button string="Quitar No Aplica" type="object" name="action_unmark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'capacitacion'}"/>
                <field name="line_ids_capacitacion" mode="list"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'capacitacion',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_code','=','capacitacion'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

            </notebook>
          </sheet>
        </form>
      </field>
    </record>

  </data>
</odoo>
