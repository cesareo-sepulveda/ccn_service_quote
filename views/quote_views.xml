<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- ================================
         LISTA (vista inicial)
       ================================ -->
    <record id="ccn_view_quote_list" model="ir.ui.view">
      <field name="name">ccn.quote.list</field>
      <field name="model">ccn.service.quote</field>
      <field name="type">list</field>
      <field name="priority">1</field>
      <field name="arch" type="xml">
        <list string="Cotizaciones CCN" default_order="partner_id,name">
          <field name="partner_id" string="Cliente"/>
          <field name="name" string="Cotizaci贸n"/>
          <field name="state" string="Estado" widget="badge" decoration-danger="state == 'draft'" decoration-warning="state == 'pending'" decoration-success="state == 'authorized'"/>
          <field name="current_site_id" string="Sitio actual" optional="hide"/>
          <field name="display_mode" string="Modo presentaci贸n" optional="hide"/>
          <field name="create_date" string="Creado" optional="hide"/>
          <field name="write_date" string="Actualizado" optional="hide"/>
        </list>
      </field>
    </record>

    <!-- ================================
         SEARCH (filtros/b煤squeda)
       ================================ -->
    <record id="ccn_view_quote_search" model="ir.ui.view">
      <field name="name">ccn.quote.search</field>
      <field name="model">ccn.service.quote</field>
      <field name="type">search</field>
      <field name="arch" type="xml">
        <search string="Buscar Cotizaciones">
          <field name="name" string="Cotizaci贸n"/>
          <field name="partner_id" string="Cliente"/>
          <field name="current_service_type" string="Tipo de servicio"/>
          <filter string="Jardiner铆a" name="f_jardineria"
                  domain="[('current_service_type','=','jardineria')]"/>
          <filter string="Limpieza" name="f_limpieza"
                  domain="[('current_service_type','=','limpieza')]"/>
          <group expand="0" string="Agrupar por">
            <filter string="Cliente" name="g_partner" context="{'group_by':'partner_id'}"/>
            <filter string="Tipo de servicio" name="g_service_type" context="{'group_by':'current_service_type'}"/>
          </group>
        </search>
      </field>
    </record>

    <!-- ================================
         FORM (con etiquetas expl铆citas)
       ================================ -->
    <record id="ccn_view_quote_form" model="ir.ui.view">
      <field name="name">ccn.quote.form</field>
      <field name="model">ccn.service.quote</field>
      <field name="type">form</field>
      <field name="arch" type="xml">
        <form string="Cotizador Especial CCN" class="ccn-quote">
          <header>
            <button name="action_authorize" string="Autorizar Cotizaci贸n" type="object"
                    class="btn-primary" invisible="state != 'pending' or not is_authorizer"/>
            <field name="state" widget="statusbar" options="{'clickable': false}"/>
          </header>
          <sheet>
            <!-- Campos invisibles para condiciones -->
            <field name="can_request_authorization" invisible="1"/>
            <field name="is_authorizer" invisible="1"/>

            <!-- Botones inteligentes -->
            <div class="oe_button_box" name="button_box">
              <button name="action_request_authorization" type="object"
                      class="oe_stat_button" icon="fa-check-circle"
                      invisible="not can_request_authorization or state != 'draft'">
                <div class="o_stat_info">
                  <span class="o_stat_text">Solicitar</span>
                  <span class="o_stat_text">Autorizaci贸n</span>
                </div>
              </button>
            </div>

            <!-- ===== Cabecera (2 columnas) ===== -->
            <group>
            <div class="ccn-quote__header-row">
            <group col="2">

              <!-- Cliente -->
                <field name="partner_id" required="1" string="Cliente" readonly="state == 'authorized'" options="{'no_open': True, 'no_quick_create': True, 'no_create': True, 'no_create_edit': True}"/>

                <!-- Nombre de la cotizaci贸n -->
                <field name="name" string="Nombre de la cotizaci贸n" readonly="state == 'authorized'"/>
 
                <!-- Sitio + bot贸n (bot贸n bajo el campo en misma columna) -->
                <!-- Sitio actual (selector) -->
                <field name="current_site_id" string="Sitio"
                       domain="[('id','in', site_ids), ('active','=', True)]"
                       context="{'default_quote_id': id}"
                       options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"
                       readonly="state == 'authorized'"/>

                <!-- Tabla de sitios retirada a petici贸n; selecci贸n se hace arriba -->

                <!-- Espaciador con estilo de etiqueta (NO usar <label/> vac铆o en Odoo 18) -->
                <!-- Bot贸n Sitio General retirado: se preselecciona autom谩ticamente -->

                <!-- Tipo de servicio -->
                <field name="current_service_type" string="Tipo de servicio"/>

                <!-- Par谩metros -->
                <field name="display_mode" string="Modo de presentaci贸n" readonly="state == 'authorized'"/>
 
                <field name="admin_percent" string="Administraci贸n (%)" readonly="state == 'authorized'"/>

                <field name="utility_percent" string="Utilidad (%)" readonly="state == 'authorized'"/>

                <field name="financial_percent" string="Costo Financiero (%)" readonly="state == 'authorized'"/>

                <field name="transporte_rate" string="Tarifa Transporte P/P" readonly="state == 'authorized'"/>

                <field name="bienestar_rate" string="Tarifa Bienestar P/P" readonly="state == 'authorized'"/>

                <field name="prestaciones_percent" string="Porcentaje prestaciones (%)" readonly="state == 'authorized'"/>

            </group>

            <!-- Panel de Indicadores -->
            <div class="ccn-quote__metrics">
              <h4>Indicadores</h4>
              <!-- Campo de moneda necesario para el widget monetary -->
              <field name="currency_id" invisible="1"/>

              <!-- TABLA: Resumen del Sitio (cuando current_service_type = 'resumen_sitio') -->
              <div invisible="current_service_type != 'resumen_sitio'">
                <div class="mb-2 p-2 bg-light border-start border-success border-5" style="font-size: 0.9rem;">
                  <strong>SITIO:</strong> <field name="current_site_id" nolabel="1" readonly="1" style="display: inline;"/>
                </div>
                <table class="table table-sm table-bordered table-hover mb-3">
                  <thead class="table-light">
                    <tr>
                      <th style="width: 50%;"></th>
                      <th class="text-center" style="width: 25%;">Costo Unitario</th>
                      <th class="text-center" style="width: 25%;">Costo Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Rubros que componen SUBTOTAL 1 -->
                    <tr>
                      <td>Mano de Obra</td>
                      <td class="text-end"><field name="indicator_sitio_mano_obra_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_mano_obra" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Uniformes</td>
                      <td class="text-end"><field name="indicator_sitio_uniformes_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_uniformes" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>EPP</td>
                      <td class="text-end"><field name="indicator_sitio_epp_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_epp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>EPP Alturas</td>
                      <td class="text-end"><field name="indicator_sitio_epp_alturas_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_epp_alturas" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Equipo Especial de Limpieza</td>
                      <td class="text-end"><field name="indicator_sitio_equipo_especial_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_equipo_especial" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Comunicaci贸n y C贸mputo</td>
                      <td class="text-end"><field name="indicator_sitio_comunicacion_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_comunicacion" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Herramienta Menor Jardiner铆a</td>
                      <td class="text-end"><field name="indicator_sitio_herramienta_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_herramienta" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Material de Limpieza</td>
                      <td class="text-end"><field name="indicator_sitio_material_limpieza_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_material_limpieza" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>

                    <!-- SUBTOTAL 1 -->
                    <tr class="table-secondary fw-bold">
                      <td><strong>SUBTOTAL 1</strong></td>
                      <td class="text-end"><field name="indicator_sitio_subtotal_1_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_subtotal_1" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>

                    <!-- Administraci贸n y Utilidad -->
                    <tr>
                      <td>Administraci贸n <field name="indicator_sitio_administracion_pct" nolabel="1" readonly="1" style="display: inline;"/>%</td>
                      <td class="text-end"><field name="indicator_sitio_administracion_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_administracion" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Utilidad <field name="indicator_sitio_utilidad_pct" nolabel="1" readonly="1" style="display: inline;"/>%</td>
                      <td class="text-end"><field name="indicator_sitio_utilidad_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_utilidad" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>

                    <!-- SUBTOTAL 2 -->
                    <tr class="table-info fw-bold">
                      <td><strong>SUBTOTAL 2</strong></td>
                      <td class="text-end"><field name="indicator_sitio_subtotal_2_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_subtotal_2" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>

                    <!-- Rubros adicionales que componen el TOTAL ANTES DE IVA -->
                    <tr>
                      <td>Perfil M茅dico</td>
                      <td class="text-end"><field name="indicator_sitio_perfil_medico_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_perfil_medico" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Maquinaria de Limpieza</td>
                      <td class="text-end"><field name="indicator_sitio_maquinaria_limpieza_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_maquinaria_limpieza" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Maquinaria de Jardiner铆a</td>
                      <td class="text-end"><field name="indicator_sitio_maquinaria_jardineria_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_maquinaria_jardineria" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Fertilizantes y Tierra Lama</td>
                      <td class="text-end"><field name="indicator_sitio_fertilizantes_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_fertilizantes" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Consumibles de Jardiner铆a</td>
                      <td class="text-end"><field name="indicator_sitio_consumibles_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_consumibles" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Transporte</td>
                      <td class="text-end"><field name="indicator_sitio_transporte_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_transporte" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Bienestar</td>
                      <td class="text-end"><field name="indicator_sitio_bienestar_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_bienestar" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Capacitaci贸n</td>
                      <td class="text-end"><field name="indicator_sitio_capacitacion_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_capacitacion" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Costo Financiero <field name="indicator_sitio_costo_financiero_pct" nolabel="1" readonly="1" style="display: inline;"/>%</td>
                      <td class="text-end"><field name="indicator_sitio_costo_financiero_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_costo_financiero" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>

                    <!-- TOTAL ANTES DE IVA -->
                    <tr class="table-warning fw-bold">
                      <td><strong>TOTAL MENSUAL ANTES DE I.V.A.</strong></td>
                      <td class="text-end"><field name="indicator_sitio_total_mensual_antes_iva_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_sitio_total_mensual_antes_iva" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>

                    <!-- IVA -->
                    <tr>
                      <td colspan="2"><strong>I.V.A. (16%)</strong></td>
                      <td class="text-end"><field name="indicator_sitio_iva" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>

                    <!-- TOTAL CON IVA -->
                    <tr class="table-primary fw-bold">
                      <td colspan="2"><strong>TOTAL MENSUAL CON I.V.A.</strong></td>
                      <td class="text-end"><field name="indicator_sitio_total_mensual_con_iva" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                  </tbody>
                </table>
                <div class="d-flex gap-2">
                  <button name="action_show_general_summary" string=" Mostrar Resumen General" type="object" class="btn btn-primary btn-sm"/>
                  <button name="action_generate_full_pdf" string=" Generar PDF Completo" type="object" class="btn btn-secondary btn-sm"/>
                </div>
              </div>

              <!-- TABLA: Jardiner铆a (cuando current_service_type = 'jardineria') -->
              <div invisible="current_service_type != 'jardineria'">
                <div class="mb-2 p-2 bg-light border-start border-primary border-5" style="font-size: 0.9rem;">
                  <strong>Sitio:</strong> <field name="current_site_id" nolabel="1" readonly="1" style="display: inline;"/> |
                  <strong>Servicio:</strong> Jardiner铆a |
                  <strong>Colaboradores:</strong> <field name="indicator_servicio_total_colaboradores" nolabel="1" readonly="1" style="display: inline;"/> |
                  <strong>Prestaciones:</strong> <field name="indicator_servicio_pct_prestaciones" nolabel="1" readonly="1" style="display: inline;"/>%
                </div>
                <table class="table table-sm table-bordered table-hover mb-0">
                  <thead class="table-light">
                    <tr>
                      <th style="width: 50%;">Rubro</th>
                      <th class="text-center" style="width: 25%;">Total</th>
                      <th class="text-center" style="width: 25%;">Por Persona</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Mano de Obra</td>
                      <td class="text-end"><field name="indicator_servicio_mano_obra" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_mano_obra_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Uniformes</td>
                      <td class="text-end"><field name="indicator_servicio_uniformes" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_uniformes_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>EPP</td>
                      <td class="text-end"><field name="indicator_servicio_epp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_epp_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>EPP Alturas</td>
                      <td class="text-end"><field name="indicator_servicio_epp_alturas" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_epp_alturas_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Comunicaci贸n y C贸mputo</td>
                      <td class="text-end"><field name="indicator_servicio_comunicacion" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_comunicacion_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Herramienta Menor Jardiner铆a</td>
                      <td class="text-end"><field name="indicator_servicio_herramienta" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_herramienta_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Perfil M茅dico</td>
                      <td class="text-end"><field name="indicator_servicio_perfil_medico" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_perfil_medico_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Maquinaria de Jardiner铆a</td>
                      <td class="text-end"><field name="indicator_servicio_maquinaria" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_maquinaria_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Fertilizantes y Tierra Lama</td>
                      <td class="text-end"><field name="indicator_servicio_fertilizantes" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_fertilizantes_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Consumibles de Jardiner铆a</td>
                      <td class="text-end"><field name="indicator_servicio_consumibles" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_consumibles_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Capacitaci贸n</td>
                      <td class="text-end"><field name="indicator_servicio_capacitacion" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_capacitacion_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr class="table-primary fw-bold">
                      <td><strong>TOTAL</strong></td>
                      <td class="text-end"><field name="indicator_servicio_total" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_total_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- TABLA: Limpieza (cuando current_service_type = 'limpieza') -->
              <div invisible="current_service_type != 'limpieza'">
                <div class="mb-2 p-2 bg-light border-start border-info border-5" style="font-size: 0.9rem;">
                  <strong>Sitio:</strong> <field name="current_site_id" nolabel="1" readonly="1" style="display: inline;"/> |
                  <strong>Servicio:</strong> Limpieza |
                  <strong>Colaboradores:</strong> <field name="indicator_servicio_total_colaboradores" nolabel="1" readonly="1" style="display: inline;"/> |
                  <strong>Prestaciones:</strong> <field name="indicator_servicio_pct_prestaciones" nolabel="1" readonly="1" style="display: inline;"/>%
                </div>
                <table class="table table-sm table-bordered table-hover mb-0">
                  <thead class="table-light">
                    <tr>
                      <th style="width: 50%;">Rubro</th>
                      <th class="text-center" style="width: 25%;">Total</th>
                      <th class="text-center" style="width: 25%;">Por Persona</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Mano de Obra</td>
                      <td class="text-end"><field name="indicator_servicio_mano_obra" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_mano_obra_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Uniformes</td>
                      <td class="text-end"><field name="indicator_servicio_uniformes" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_uniformes_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>EPP</td>
                      <td class="text-end"><field name="indicator_servicio_epp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_epp_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Equipo Especial de Limpieza</td>
                      <td class="text-end"><field name="indicator_servicio_equipo_especial" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_equipo_especial_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Comunicaci贸n y C贸mputo</td>
                      <td class="text-end"><field name="indicator_servicio_comunicacion" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_comunicacion_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Material de Limpieza</td>
                      <td class="text-end"><field name="indicator_servicio_material_limpieza" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_material_limpieza_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Perfil M茅dico</td>
                      <td class="text-end"><field name="indicator_servicio_perfil_medico" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_perfil_medico_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Maquinaria de Limpieza</td>
                      <td class="text-end"><field name="indicator_servicio_maquinaria_limpieza" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_maquinaria_limpieza_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr>
                      <td>Capacitaci贸n</td>
                      <td class="text-end"><field name="indicator_servicio_capacitacion" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_capacitacion_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                    <tr class="table-primary fw-bold">
                      <td><strong>TOTAL</strong></td>
                      <td class="text-end"><field name="indicator_servicio_total" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                      <td class="text-end"><field name="indicator_servicio_total_pp" nolabel="1" readonly="1" widget="monetary" options="{'currency_field': 'currency_id'}"/></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            </div>
            </group>

            <!-- Estados/contadores publicados en DOM para JS (ocultos por CSS, no por invisible) -->
            <div class="d-none o_ccn_rubro_states">
              <field name="rubro_state_mano_obra"/>
              <field name="rubro_state_uniforme"/>
              <field name="rubro_state_epp"/>
              <field name="rubro_state_epp_alturas"/>
              <field name="rubro_state_equipo_especial_limpieza"/>
              <field name="rubro_state_comunicacion_computo"/>
              <field name="rubro_state_herramienta_menor_jardineria"/>
              <field name="rubro_state_material_limpieza"/>
              <field name="rubro_state_perfil_medico"/>
              <field name="rubro_state_maquinaria_limpieza"/>
              <field name="rubro_state_maquinaria_jardineria"/>
              <field name="rubro_state_fertilizantes_tierra_lama"/>
              <field name="rubro_state_consumibles_jardineria"/>
              <field name="rubro_state_capacitacion"/>
              <!-- Contadores por rubro -->
              <field name="rubro_count_mano_obra"/>
              <field name="rubro_count_uniforme"/>
              <field name="rubro_count_epp"/>
              <field name="rubro_count_epp_alturas"/>
              <field name="rubro_count_equipo_especial_limpieza"/>
              <field name="rubro_count_comunicacion_computo"/>
              <field name="rubro_count_herramienta_menor_jardineria"/>
              <field name="rubro_count_material_limpieza"/>
              <field name="rubro_count_perfil_medico"/>
              <field name="rubro_count_maquinaria_limpieza"/>
              <field name="rubro_count_maquinaria_jardineria"/>
              <field name="rubro_count_fertilizantes_tierra_lama"/>
              <field name="rubro_count_consumibles_jardineria"/>
              <field name="rubro_count_capacitacion"/>
            </div>

            <!-- ===== Tabs por rubro (solo visibles con tipo de servicio) ===== -->
            <notebook invisible="not current_service_type" readonly="state == 'authorized'">
              <!-- Placeholder inicial: evita que se abra un tab con l铆neas por defecto -->
              <page string="Selecciona un rubro" name="page__placeholder">
                <div class="p-3 text-center text-muted">
                  Selecciona un rubro para ver sus l铆neas.
                </div>
              </page>

              <!-- Mano de Obra -->
              <page string="Mano de Obra" name="page_mano_obra"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'mano_obra'}" invisible="rubro_state_mano_obra != 0 or state == 'authorized'"/>
                <!-- Jardiner铆a -->
                <field name="line_ids_mano_obra_jardineria" mode="list"
                        readonly="state == 'authorized'"
                        invisible="current_service_type != 'jardineria'"
                        context="{
                          'default_quote_id': id,
                          'default_site_id': current_site_id,
                          'default_service_type': current_service_type,
                          'ctx_rubro_code': 'mano_obra',
                          'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline_mano_obra',
                          'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline_mano_obra'
                        }"
                        domain="[
                          ('rubro_id.code','=','mano_obra'),
                          ('service_type','=','jardineria'),
                          ('site_id','=', current_site_id)
                        ]"/>

                <!-- Limpieza -->
                <field name="line_ids_mano_obra_limpieza" mode="list"
                        readonly="state == 'authorized'"
                        invisible="current_service_type != 'limpieza'"
                        context="{
                          'default_quote_id': id,
                          'default_site_id': current_site_id,
                          'default_service_type': current_service_type,
                          'ctx_rubro_code': 'mano_obra',
                          'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline_mano_obra',
                          'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline_mano_obra'
                        }"
                        domain="[
                          ('rubro_id.code','=','mano_obra'),
                          ('service_type','=','limpieza'),
                          ('site_id','=', current_site_id)
                        ]"/>
              </page>

              <!-- Uniforme -->
              <page string="Uniforme" name="page_uniforme"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'uniforme'}" invisible="rubro_state_uniforme != 0 or state == 'authorized'"/>
                <field name="line_ids_uniforme_jardineria" mode="list"
                        readonly="state == 'authorized'"
                       invisible="current_service_type != 'jardineria'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'uniforme',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','uniforme'),
                         ('service_type','=','jardineria'),
                         ('site_id','=', current_site_id)
                       ]"/>
                <field name="line_ids_uniforme_limpieza" mode="list"
                        readonly="state == 'authorized'"
                       invisible="current_service_type != 'limpieza'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'uniforme',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','uniforme'),
                         ('service_type','=','limpieza'),
                         ('site_id','=', current_site_id)
                       ]"/>
              </page>

              <!-- EPP -->
              <page string="EPP" name="page_epp"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp'}" invisible="rubro_state_epp != 0 or state == 'authorized'"/>
                <field name="line_ids_epp_jardineria" mode="list"
                        readonly="state == 'authorized'"
                       invisible="current_service_type != 'jardineria'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','epp'),
                         ('service_type','=','jardineria'),
                         ('site_id','=', current_site_id)
                       ]"/>
                <field name="line_ids_epp_limpieza" mode="list"
                        readonly="state == 'authorized'"
                       invisible="current_service_type != 'limpieza'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','epp'),
                         ('service_type','=','limpieza'),
                         ('site_id','=', current_site_id)
                       ]"/>
              </page>

              <!-- EPP Alturas (solo jardiner铆a) -->
              <page string="EPP Alturas" name="page_epp_alturas"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'epp_alturas'}" invisible="rubro_state_epp_alturas_jard != 0 or state == 'authorized'"/>
                <field name="line_ids_epp_alturas" mode="list"
                        readonly="state == 'authorized'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'epp_alturas',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','epp_alturas'),
                         ('site_id','=', current_site_id),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Equipo Especial de Limpieza (solo limpieza) -->
              <page string="Equipo Especial de Limpieza" name="page_equipo_especial_limpieza"
                    invisible="current_service_type != 'limpieza'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'equipo_especial_limpieza'}" invisible="rubro_state_equipo_especial_limpieza_limp != 0 or state == 'authorized'"/>
                <field name="line_ids_equipo_especial_limpieza" mode="list"
                        readonly="state == 'authorized'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'equipo_especial_limpieza',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','equipo_especial_limpieza'),
                         ('site_id','=', current_site_id),
                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Comunicaci贸n y C贸mputo -->
              <page string="Comunicaci贸n y C贸mputo" name="page_comunicacion_computo"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'comunicacion_computo'}" invisible="rubro_state_comunicacion_computo != 0 or state == 'authorized'"/>
                <field name="line_ids_comunicacion_computo_jardineria" mode="list"
                        readonly="state == 'authorized'"
                       invisible="current_service_type != 'jardineria'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'comunicacion_computo',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','comunicacion_computo'),
                         ('service_type','=','jardineria'),
                         ('site_id','=', current_site_id)
                       ]"/>
                <field name="line_ids_comunicacion_computo_limpieza" mode="list"
                        readonly="state == 'authorized'"
                       invisible="current_service_type != 'limpieza'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'comunicacion_computo',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','comunicacion_computo'),
                         ('service_type','=','limpieza'),
                         ('site_id','=', current_site_id)
                       ]"/>
              </page>

              <!-- Herr. Menor Jardiner铆a (solo jardiner铆a) -->
              <page string="Herr. Menor Jardiner铆a" name="page_herr_menor_jardineria"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'herramienta_menor_jardineria'}" invisible="rubro_state_herramienta_menor_jardineria_jard != 0 or state == 'authorized'"/>
                <field name="line_ids_herramienta_menor_jardineria" mode="list"
                        readonly="state == 'authorized'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'herramienta_menor_jardineria',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','herramienta_menor_jardineria'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Material de Limpieza (solo limpieza) -->
              <page string="Material de Limpieza" name="page_material_limpieza"
                    invisible="current_service_type != 'limpieza'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'material_limpieza'}" invisible="rubro_state_material_limpieza_limp != 0 or state == 'authorized'"/>
                <field name="line_ids_material_limpieza" mode="list"
                        readonly="state == 'authorized'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'material_limpieza',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','material_limpieza'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Perfil M茅dico -->
              <page string="Perfil M茅dico" name="page_perfil_medico"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'perfil_medico'}" invisible="rubro_state_perfil_medico != 0 or state == 'authorized'"/>
                <field name="line_ids_perfil_medico_jardineria" mode="list"
                        readonly="state == 'authorized'"
                       invisible="current_service_type != 'jardineria'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'perfil_medico',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','perfil_medico'),
                         ('service_type','=','jardineria'),
                         ('site_id','=', current_site_id)
                       ]"/>
                <field name="line_ids_perfil_medico_limpieza" mode="list"
                        readonly="state == 'authorized'"
                       invisible="current_service_type != 'limpieza'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'perfil_medico',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','perfil_medico'),
                         ('service_type','=','limpieza'),
                         ('site_id','=', current_site_id)
                       ]"/>
              </page>

              <!-- Maquinaria de Limpieza (solo limpieza) -->
              <page string="Maquinaria de Limpieza" name="page_maquinaria_limpieza"
                    invisible="current_service_type != 'limpieza'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_limpieza'}" invisible="rubro_state_maquinaria_limpieza_limp != 0 or state == 'authorized'"/>
                <field name="line_ids_maquinaria_limpieza" mode="list"
                        readonly="state == 'authorized'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'maquinaria_limpieza',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','maquinaria_limpieza'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Maquinaria de Jardiner铆a (solo jardiner铆a) -->
              <page string="Maquinaria de Jardiner铆a" name="page_maquinaria_jardineria"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'maquinaria_jardineria'}" invisible="rubro_state_maquinaria_jardineria_jard != 0 or state == 'authorized'"/>
                <field name="line_ids_maquinaria_jardineria" mode="list"
                        readonly="state == 'authorized'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'maquinaria_jardineria',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','maquinaria_jardineria'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Fertilizantes y Tierra Lama (solo jardiner铆a) -->
              <page string="Fertilizantes y Tierra Lama" name="page_fertilizantes_tierra_lama"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'fertilizantes_tierra_lama'}" invisible="rubro_state_fertilizantes_tierra_lama_jard != 0 or state == 'authorized'"/>
                <field name="line_ids_fertilizantes_tierra_lama" mode="list"
                        readonly="state == 'authorized'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'fertilizantes_tierra_lama',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','fertilizantes_tierra_lama'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Consumibles de Jardiner铆a (solo jardiner铆a) -->
              <page string="Consumibles de Jardiner铆a" name="page_consumibles_jardineria"
                    invisible="current_service_type != 'jardineria'">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'consumibles_jardineria'}" invisible="rubro_state_consumibles_jardineria_jard != 0 or state == 'authorized'"/>
                <field name="line_ids_consumibles_jardineria" mode="list"
                        readonly="state == 'authorized'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,

                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'consumibles_jardineria',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','consumibles_jardineria'),
                         ('site_id','=', current_site_id),

                         ('service_type','=', current_service_type)
                       ]"/>
              </page>

              <!-- Capacitaci贸n -->
              <page string="Capacitaci贸n" name="page_capacitacion"
                    invisible="current_service_type not in ['jardineria', 'limpieza']">
                <button string="No Aplica" type="object" name="action_mark_rubro_empty" class="btn btn-secondary"
                        context="{'rubro_code': 'capacitacion'}" invisible="rubro_state_capacitacion != 0 or state == 'authorized'"/>
                <field name="line_ids_capacitacion_jardineria" mode="list"
                        readonly="state == 'authorized'"
                       invisible="current_service_type != 'jardineria'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'capacitacion',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','capacitacion'),
                         ('service_type','=','jardineria'),
                         ('site_id','=', current_site_id)
                       ]"/>
                <field name="line_ids_capacitacion_limpieza" mode="list"
                        readonly="state == 'authorized'"
                       invisible="current_service_type != 'limpieza'"
                       context="{
                         'default_quote_id': id,
                         'default_site_id': current_site_id,
                         'default_service_type': current_service_type,
                         'ctx_rubro_code': 'capacitacion',
                         'list_view_ref': 'ccn_service_quote.ccn_view_quote_line_list_inline',
                         'form_view_ref': 'ccn_service_quote.ccn_view_quote_line_form_inline'
                       }"
                       domain="[
                         ('rubro_id.code','=','capacitacion'),
                         ('service_type','=','limpieza'),
                         ('site_id','=', current_site_id)
                       ]"/>
              </page>

            </notebook>
          </sheet>

          <!-- Chatter -->
          <chatter/>
        </form>
      </field>
    </record>

  </data>
</odoo>
